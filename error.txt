üö® CLINIC SYSTEM - RESTART LOOP DIAGNOSTIC
============================================

üìä Estado actual de contenedores:
NAMES                    STATUS                          PORTS
clinic-frontend-client   Restarting (1) 39 seconds ago
clinic-admin-system      Restarting (3) 17 seconds ago
cms-clinica              Up 3 days                       0.0.0.0:60520->1337/tcp, [::]:60520->1337/tcp

üîç DIAGN√ìSTICO ADMIN SYSTEM
============================
üìã √öltimos logs del admin system:
  File "/usr/local/lib/python3.11/site-packages/pymongo/auth.py", line 257, in _authenticate_scram
    res = conn.command(source, cmd)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pymongo/helpers.py", line 322, in inner
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pymongo/pool.py", line 968, in command
    return command(
           ^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/pymongo/network.py", line 192, in command
    helpers._check_command_response(
  File "/usr/local/lib/python3.11/site-packages/pymongo/helpers.py", line 230, in _check_command_response
    raise OperationFailure(errmsg, code, response, max_wire_version)
pymongo.errors.OperationFailure: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}

ERROR:    Application startup failed. Exiting.
Found UNIFIED frontend at static/admin
Mounted admin assets at /admin/assets
Starting Clinic Admin Backend...
Error connecting to MongoDB: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}

üîç Errores espec√≠ficos:
ERROR:    Application startup failed. Exiting.
Error connecting to MongoDB: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}
ERROR:    Traceback (most recent call last):
pymongo.errors.OperationFailure: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}
ERROR:    Application startup failed. Exiting.
Error connecting to MongoDB: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}
ERROR:    Traceback (most recent call last):
pymongo.errors.OperationFailure: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}
ERROR:    Application startup failed. Exiting.
Error connecting to MongoDB: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed'}

üîß Variables de entorno del contenedor:
Error response from daemon: Container f61f67e9bd458da9715340a26be497a33232c01f59642008af43ead105e7c3e3 is restarting, wait until the container is running
No se puede acceder - contenedor reiniciando

üîç DIAGN√ìSTICO FRONTEND CLIENT
===============================
üìã √öltimos logs del frontend client:
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: /etc/nginx/conf.d/default.conf differs from the packaged version
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2025/08/17 00:02:24 [emerg] 1#1: host not found in upstream "host.docker.internal" in /etc/nginx/conf.d/default.conf:31
nginx: [emerg] host not found in upstream "host.docker.internal" in /etc/nginx/conf.d/default.conf:31
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: /etc/nginx/conf.d/default.conf differs from the packaged version
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2025/08/17 00:03:25 [emerg] 1#1: host not found in upstream "host.docker.internal" in /etc/nginx/conf.d/default.conf:31
nginx: [emerg] host not found in upstream "host.docker.internal" in /etc/nginx/conf.d/default.conf:31

üîç Errores espec√≠ficos:

üåê CONECTIVIDAD EXTERNA
=======================
Verificando conectividad a MongoDB externa...
‚úÖ IP 192.168.1.23 accesible

Verificando puerto MongoDB (60516)...
‚úÖ Puerto 60516 abierto

Verificando conectividad MongoDB desde este servidor...
‚ö†Ô∏è MongoDB no conecta (puede ser normal si mongosh no est√° instalado)

üîç AN√ÅLISIS DE CONFIGURACIONES
===============================
Verificando archivos de configuraci√≥n creados...
‚úÖ .env.prod existe
Contenido de MONGODB_URL:
MONGODB_URL=mongodb://root:servermuenpampa2025A!@192.168.1.23:60516/clinic_admin?authSource=admin

‚úÖ docker-compose.production.yml existe
Verificando MONGODB_URL en docker-compose:
      # Base de datos externa
      MONGODB_URL: mongodb://root:servermuenpampa2025A!@192.168.1.23:60516/clinic_admin?authSource=admin


üìã RECURSOS DEL SISTEMA
=======================
Memoria disponible:
Usado: 4,3Gi/8,7Gi - Disponible: 4,4Gi

Espacio en disco:
Uso: 77% - Disponible: 11G

Procesos usando puertos relevantes:
Ning√∫n proceso en puertos relevantes

üí° RECOMENDACIONES BASADAS EN AN√ÅLISIS:
======================================
üîß PROBLEMA DETECTADO: Error de conexi√≥n a MongoDB
   Soluci√≥n: Verificar configuraci√≥n de MONGODB_URL y conectividad

üìã SIGUIENTE PASO RECOMENDADO:
Ejecutar: ./fix-restart-issues.sh (pr√≥ximo script a crear)
Presiona Enter para continuar...
