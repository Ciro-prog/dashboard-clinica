cirolinux@cirolinux:/opt/dashboard-clinica/scripts$ ./production-complete-restart.sh

üîÑ CLINIC SYSTEM - PRODUCTION COMPLETE RESTART
==============================================

‚ö†Ô∏è IMPORTANTE: Este script aplicar√° TODAS las mejoras de reestructuraci√≥n
   - Detendr√° servicios obsoletos
   - Aplicar√° configuraciones de producci√≥n
   - Conectar√° a DB externa: 192.168.1.23:60516
   - Configurar√° URLs de producci√≥n: pampaservers.com

¬øContinuar con restart completo? (y/N): y

üìä ESTADO ACTUAL:
NAMES                    STATUS                          PORTS
clinic-frontend-client   Restarting (1) 25 seconds ago
cms-clinica              Up 3 days                       0.0.0.0:60520->1337/tcp, [::]:60520->1337/tcp

üõë PASO 1: Deteniendo TODOS los servicios clinic
================================================
Deteniendo clinic-frontend-client...
clinic-frontend-client
Deteniendo clinic-backend-api...
Ya detenido
Deteniendo clinic-admin-frontend...
Ya detenido
Deteniendo clinic-admin-system...
Ya detenido
Deteniendo clinic-admin-mongodb...
Ya detenido

üßπ PASO 2: Limpiando contenedores detenidos
============================================
Deleted Containers:
f82bcb5a26e30e85c58859ce1aa20c4d86f2a99b9cd2d1604140fba961c7e56d

Total reclaimed space: 1.867kB

üîß PASO 3: Verificando conectividad con DB de producci√≥n
=======================================================
Verificando conexi√≥n a 192.168.1.23:60516...
‚úÖ IP accesible

üìù PASO 4: Configurando variables de producci√≥n
===============================================
Creando .env de producci√≥n...
‚úÖ Configuraci√≥n de producci√≥n creada

üîß PASO 5: Actualizando docker-compose para producci√≥n
======================================================
Creando docker-compose.production.yml...
‚úÖ docker-compose.production.yml creado

üöÄ PASO 6: Iniciando Admin System con configuraci√≥n de producci√≥n
==================================================================
[+] Building 210.1s (25/25) FINISHED
 => [internal] load local bake definitions                                                                                                                                              0.0s
 => => reading from stdin 595B                                                                                                                                                          0.0s
 => [internal] load build definition from Dockerfile.admin                                                                                                                              0.2s
 => => transferring dockerfile: 1.20kB                                                                                                                                                  0.0s
 => [internal] load metadata for docker.io/library/node:18-alpine                                                                                                                       1.6s
 => [internal] load metadata for docker.io/library/python:3.11-slim                                                                                                                     1.6s
 => [auth] library/node:pull token for registry-1.docker.io                                                                                                                             0.0s
 => [auth] library/python:pull token for registry-1.docker.io                                                                                                                           0.0s
 => [internal] load .dockerignore                                                                                                                                                       0.2s
 => => transferring context: 1.22kB                                                                                                                                                     0.0s
 => CACHED [stage-1 1/9] FROM docker.io/library/python:3.11-slim@sha256:9e885f8239c31f8429448f933638dd13037c9119e2a362aeebdd37ec3bee7c85                                                0.0s
 => [frontend-builder 1/6] FROM docker.io/library/node:18-alpine@sha256:8d6421d663b4c28fd3ebc498332f249011d118945588d0a35cb9bc4b8ca09d9e                                                0.0s
 => [internal] load build context                                                                                                                                                       0.3s
 => => transferring context: 10.36kB                                                                                                                                                    0.0s
 => [stage-1 2/9] RUN apt-get update && apt-get install -y     gcc     curl     && rm -rf /var/lib/apt/lists/*                                                                         76.7s
 => CACHED [frontend-builder 2/6] WORKDIR /app/frontend-admin                                                                                                                           0.0s
 => CACHED [frontend-builder 3/6] COPY frontend-admin/package*.json ./                                                                                                                  0.0s
 => [frontend-builder 4/6] RUN npm install                                                                                                                                             22.8s
 => [frontend-builder 5/6] COPY frontend-admin/ ./                                                                                                                                      1.8s
 => [frontend-builder 6/6] RUN npm run build                                                                                                                                           14.2s
 => [stage-1 3/9] WORKDIR /app                                                                                                                                                          1.0s
 => [stage-1 4/9] COPY requirements.txt .                                                                                                                                               1.0s
 => [stage-1 5/9] RUN pip install --no-cache-dir -r requirements.txt                                                                                                                  106.9s
 => [stage-1 6/9] COPY app/ ./app/                                                                                                                                                      0.9s
 => [stage-1 7/9] COPY main.py .                                                                                                                                                        0.8s
 => [stage-1 8/9] COPY --from=frontend-builder /app/frontend-admin/dist ./static/admin                                                                                                  1.3s
 => [stage-1 9/9] RUN mkdir -p uploads                                                                                                                                                  1.5s
 => exporting to image                                                                                                                                                                 16.3s
 => => exporting layers                                                                                                                                                                15.8s
 => => writing image sha256:dd86642371c3ea9af4c01106e28d44e4f35b5281bb3b6b60a1a4f5524f123057                                                                                            0.1s
 => => naming to docker.io/library/clinic-admin-backend-admin-system                                                                                                                    0.1s
 => resolving provenance for metadata file                                                                                                                                              0.0s
[+] Running 4/4
 ‚úî clinic-admin-backend-admin-system            Built                                                                                                                                   0.0s
 ‚úî Network clinic-admin-backend_admin-network   Created                                                                                                                                 0.4s
 ‚úî Volume "clinic-admin-backend_admin_uploads"  Created                                                                                                                                 0.1s
 ‚úî Container clinic-admin-system                Started                                                                                                                                 3.5s

‚è≥ Esperando que el sistema est√© listo...

üöÄ PASO 7: Iniciando Frontend Client con configuraci√≥n de producci√≥n
=====================================================================
Actualizando configuraci√≥n de frontend client...
[+] Running 1/1
 ‚úî Container clinic-frontend-client  Started                                                                                                                                            2.2s

‚è≥ Esperando que frontend client est√© listo...

üìä PASO 8: Verificando estado final
===================================
=== CONTENEDORES ACTIVOS ===
NAMES                    STATUS                                  PORTS
clinic-frontend-client   Restarting (1) Less than a second ago
clinic-admin-system      Up 2 seconds (health: starting)         0.0.0.0:60519->8000/tcp, [::]:60519->8000/tcp
cms-clinica              Up 3 days                               0.0.0.0:60520->1337/tcp, [::]:60520->1337/tcp

=== HEALTH CHECKS ===
Verificando Admin System (60519)...
‚ùå Admin System Error
Verificando Frontend Client (60521)...
‚ùå Frontend Client Error

=== CONECTIVIDAD INTERNA ===
Verificando servicios internos...
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
‚úÖ Puerto 60519 abierto
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
‚ö†Ô∏è Puerto 60521 no disponible

‚úÖ RESTART COMPLETO FINALIZADO
==============================

üåê URLs DE PRODUCCI√ìN:
   üîß API Backend:       http://pampaservers.com:60519
   üìö API Docs:          http://pampaservers.com:60519/docs
   üè• Admin Dashboard:   http://pampaservers.com:60519/admin
   üë• Client Dashboard:  http://pampaservers.com:60521

üîê Credenciales Admin:
   Usuario: admin
   Contrase√±a: admin123

üìã Para acceder al ApiDocumentationModal:
   1. Ir a http://pampaservers.com:60519/admin
   2. Login con credenciales admin
   3. Tab 'Cl√≠nicas' ‚Üí Bot√≥n 'Documentaci√≥n'

üóÑÔ∏è Base de datos:
   Host: 192.168.1.23:60516
   Usuario: root
   Password: servermuenpampa2025A!
   Comando: docker exec -it mongodb mongosh -u root -p servermuenpampa2025A! --authenticationDatabase admin

üìÅ Archivos creados:
   - clinic-admin-backend/.env.prod
   - clinic-admin-backend/docker-compose.production.yml
   - docker-compose.client-prod.yml

üéâ TODOS LOS CAMBIOS DE REESTRUCTURACI√ìN APLICADOS
==================================================

‚úÖ Sistema completamente actualizado con:
   - Conexi√≥n a DB externa de producci√≥n
   - URLs de producci√≥n configuradas
   - API Keys de producci√≥n
   - CORS actualizado
   - Todas las mejoras implementadas

Presiona Enter para continuar...^C
cirolinux@cirolinux:/opt/dashboard-clinica/scripts$ docker ps
CONTAINER ID   IMAGE                                 COMMAND                  CREATED         STATUS                                  PORTS                                                     NAMES
cdea9fcbf358   dashboard-clinica-frontend-client     "/docker-entrypoint.‚Ä¶"   3 minutes ago   Restarting (1) Less than a second ago                                                             clinic-frontend-client
f61f67e9bd45   clinic-admin-backend-admin-system     "python -m uvicorn m‚Ä¶"   3 minutes ago   Restarting (3) 53 seconds ago                                                                     clinic-admin-system
c9af56e9deea   docker.n8n.io/n8nio/n8n               "tini -- /docker-ent‚Ä¶"   2 days ago      Up 2 days                               0.0.0.0:60514->5678/tcp, [::]:60514->5678/tcp             n8n
ef0301eab030   cms-clinica                           "docker-entrypoint.s‚Ä¶"   4 weeks ago     Up 3 days                               0.0.0.0:60520->1337/tcp, [::]:60520->1337/tcp             cms-clinica
135bb8fca5e6   devlikeapro/waha-plus:latest          "/usr/bin/tini -- /e‚Ä¶"   6 weeks ago     Up 3 days (unhealthy)                   0.0.0.0:60513->3000/tcp, [::]:60513->3000/tcp             waha-plus
fb6aab86fd12   mongo-express:1.0.2                   "/sbin/tini -- /dock‚Ä¶"   6 weeks ago     Up 3 days                               0.0.0.0:60517->8081/tcp, [::]:60517->8081/tcp             mongo-express
abf54630e862   mongo:7.0                             "docker-entrypoint.s‚Ä¶"   6 weeks ago     Up 3 days                               0.0.0.0:60516->27017/tcp, [::]:60516->27017/tcp           mongodb
f1322c2854a3   redis:7.2-alpine                      "docker-entrypoint.s‚Ä¶"   6 weeks ago     Up 3 days                               0.0.0.0:60515->6379/tcp, [::]:60515->6379/tcp             redis-standalone
40eda66fd12c   ghcr.io/gitroomhq/postiz-app:latest   "docker-entrypoint.s‚Ä¶"   6 weeks ago     Up 3 days                               4200/tcp, 0.0.0.0:60518->5000/tcp, [::]:60518->5000/tcp   postiz
3797af74915d   redis:7.2                             "docker-entrypoint.s‚Ä¶"   6 weeks ago     Up 3 days (healthy)                     6379/tcp                                                  postiz-redis
263faa2bcb34   postgres:17-alpine                    "docker-entrypoint.s‚Ä¶"   6 weeks ago     Up 3 days (healthy)                     5432/tcp                                                  postiz-postgres
cirolinux@cirolinux:/opt/dashboard-clinica/scripts$
